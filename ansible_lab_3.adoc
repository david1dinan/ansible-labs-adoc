ifdef::env-github[]
:tip-caption: :bulb:
:note-caption: :information_source:
:important-caption: :heavy_exclamation_mark:
:caution-caption: :fire:
:warning-caption: :warning:
:imagesdir: https://github.com/mysidlabs/ansible-labs-adoc/blob/master
endif::[]

:imagesdir: images/
:icons:

== Ansible Lab 3 - Introduction to Ansible Tower Workflows
=== Overview
Lab 3 introduces _Ansible Tower_ template workflows. In this excerxise you will 

. Create the _wait_for_ssh_ auxillary job template.
. Create a workflow template that combines the plays from the previous lab into a single, executable job run.

=== Ansible Tower Workflow Editor Overview
. Ansible tower provides a graphical UI to aid in the creation automation workflows.  
Below is an example of the workflow you will be creating throught the course of this lab. 
+
image::lab3_workflow_vis_overview.png[]
+
. The active node is indicated by a vertical blue bar displayed on the left side of the currently selected node.
Select a node by clicking on it.

* The selected node-type is determined by the drop-down in the upper right corner of the view.
It can be set as one of the following using the drop down in the top right corner of the view.
*** Template
*** Project Sync
*** Inventory Sync
*** Approval
* The right side-bar will be populated with objects of the type selected in the drop down.
* Selecting an object and clicking the image:icons/select-button.png[] button will assign that object to the current node.
+
image::lab3_workflow_node_detail.png[]
+
* image:icons/node-type.png[] - This icon represents the node type.

* image:icons/node-new.png[] - The plus icon initiates a new node in sequence directly following the currently selected node.

* image:icons/node-link.png[] - The link icon allows this node to be linked to another, already existent, node on the page.
This can be useful in creating paralell execution paths.
* image:icons/node-delete.png[] - The X icon will delete the node after a cocnfirmation.



=== Lab 3 - Ansible Tower Workflows
// Create wait_for_ssh template.
. We need to create one more _Job Template_ before we can piece together the workflow for this lab.
Create the _wait-for-ssh_ template by navigating to the _Templates_ page and click the image:icons/new.png[] button.
Populate the form with the following details:
+
* *Name*: `siduser\#\##-wait-for-ssh` where \### is replaced with your user number.
* *Job Type*: `Run`
* *Inventory*: `siduser\#\##-inventory` where \### is replaced with your usser number.
* *Project*: `siduser\#\##-repo` where \### is replaced with your usser number.
* *Playbook*: `lab2/wait_for_ssh.yml`
* *Credentials*: `ansible-labs-only`
* *Extra Variables*: In the extra variable field, please add the following, verbatim:
+
`siduser: "{{ tower_user_name}}"`
+
image::lab2_000010_extra_variables.png[]

+
[NOTE]
====
When Ansible Tower executes a workflow, the plays are run in sequence without pause.
As a result, it is likely that the _Configure_ step of the workflow will attempt to run before the OS on the newly provisioned machine has had time to start the ssh daemon. 
In order to prevent the run from failing from a connection error, the _wait-for-ssh_ play introduces a polling pause that checks for ssh connectivity before continuing with the configuration play.
====
+
// Create Workflow Template
. Log into https://tower.mysidlabs.com[tower]  (tower.mysidlabs.com)
. Navigate to the _Templates_ page.
. Click the image:icons/new.png[] button to create a new template, this time selecting *_Workflow Template_* from the pop-up.
. Populate the _New Workflow Job Template_ with the following details:
* *Name*: `siduser\###-lab3-workflow`
* *Organization*: `sid-org`
* *Inventory*: `siduser\###-inventory`
+
image::lab3_001_new_workflow_template.png[]
+
* Click the image:icons/save-button.png[] button and then launch the _Workflow Visualizer_.
+
. We will now use the workflow visualizer to compose a single workflow to deploy and configure the sample multi-tier web-app.
+





